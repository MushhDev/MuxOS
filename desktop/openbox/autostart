#!/bin/bash
# MuxOS Velocity 2.0 - Openbox Autostart
# Modern desktop with glassmorphism effects

# ============================================
# Theme Configuration
# ============================================
THEME_CONFIG="$HOME/.config/muxos/theme.json"
export GTK_THEME="MuxOS-Velocity"

# ============================================
# Wallpaper
# ============================================
if [ -f "/usr/share/backgrounds/muxos-velocity.png" ]; then
    feh --bg-fill /usr/share/backgrounds/muxos-velocity.png &
elif [ -f "/usr/share/backgrounds/muxos-velocity-1920x1080.png" ]; then
    feh --bg-fill /usr/share/backgrounds/muxos-velocity-1920x1080.png &
else
    # Fallback to solid dark color
    hsetroot -solid "#09090f" &
fi

# ============================================
# Compositor (Picom with blur and animations)
# ============================================
picom --config /etc/xdg/picom/picom.conf -b &

# ============================================
# Panel
# ============================================
sleep 0.5
tint2 -c /etc/xdg/tint2/tint2rc &

# ============================================
# System Tray Applets
# ============================================
sleep 1
nm-applet &
volumeicon &
udiskie --tray &

# ============================================
# Notification Daemon
# ============================================
dunst -config /etc/xdg/dunst/dunstrc &

# ============================================
# Display Settings (Gaming optimized)
# ============================================
xset s off          # Disable screen saver
xset -dpms          # Disable power management
xset s noblank      # Disable screen blanking
xset r rate 200 40  # Fast keyboard repeat

# ============================================
# Authentication Agent
# ============================================
/usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 &

# ============================================
# Gaming Optimizations
# ============================================
gamemode -s &

# ============================================
# Background Services
# ============================================
/usr/bin/muxos-updater --daemon &

# ============================================
# First Boot Welcome
# ============================================
FIRST_BOOT_MARKER="/var/lib/muxos/.firstboot_complete"
if [ ! -f "$FIRST_BOOT_MARKER" ]; then
    mkdir -p "$HOME/.config/muxos"
    sleep 2
    /usr/bin/muxos-welcome &
fi
